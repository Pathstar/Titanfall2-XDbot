> 纯娱乐bot，你的开心是我最大的荣幸！

------

## 功能

### 一、连杀播报

通过读取右下角击杀信息，实现存储与个性化播报：

1. **连杀数量播报**
   在连杀达到一定数量时进行播报，比如：

   - `xxx` 达成了 10 连杀！无人可挡！
   - `xxx` 达成了 15 连杀！诸天灭地！我们没救了！

2. **特色专属播报**
   不同击杀方式有独特文案，例如：

   - `xxx` 拳脚精通！使用「肘击」达成了 3 连杀！
   - `xxx` 使用神器「A盾喷火」达成了 5 连杀！是火神！我们没救了！
   - 克莱博从入门到拳脚精通！`xxx` 放弃了克莱博，使用「肘击」达成了 3 连杀！
   - xxx使用神器「自瞄小手枪」连续锁了 3 个人！
   - xxx使用神器「炸弹无人机」连续炸死了 3 个人！并炸死了TA自己！
   - 以及更多……

   除了炸弹无人机连杀按6秒内不中断计算，其余均为似了清空连杀数。

3. **中断连杀播报**
   达成 10 连杀后死亡也会有特殊播报：

   - 我们有救了！`xxx` 使用「Weapon」中断了 `xxx` 的 10 连杀！
   - 一刻也没有为 `xxx` 哀悼！`xxx` 使用「Weapon」中断了TA自己的 19 连杀！
   - 最终，没有人能中断 `xxx` 的 20 连杀

4. **其他播报**

   - 针对萌新/养老服调整播报门槛至 5 连杀

   - 分析播报信息，判断玩家被踢并提示：

     ```
     【XDbot】大笨蛋 xxx 被踢出了游戏！
     ```

   - 被踢后再次加入未成功：

     ```
     【XDbot】超级大笨蛋 xxx 在被踢后尝试再次加入，未果
     ```

------

### 二、命令系统

支持通过队伍内消息@xd，bot也会使用队内消息回复。也可将@xd置于话的末尾。
例如：`今天也要开心嗷！@xd yay`

#### 命令一览（按字母排序）

| 命令                    | 说明                                                    |
| ----------------------- | ------------------------------------------------------- |
| `@xd AI (问题)`         | 提问AI并返回回答（模型API使用Qwen 4B，支持上下文）      |
| `@xd help`              | 返回可用命令摘要                                        |
| `@xd meow`              | 喵喵妙妙妙妙妙妙妙妙                                    |
| `@xd meme`              | 随机输出一个meme笑话（待补充）                          |
| `@xd pinyin (拼音)`     | 拼音转文字，保留不可转的内容（py库 Pinyin2Hanzi）       |
| `@xd roll`              | 随机返回1~6                                             |
| `@xd time`              | 显示实际时间                                            |
| `@xd wiki`              | 返回bilibili专栏链接和github README.md网址              |
| `@xd yay`               | 随机返回可爱的颜表情                                    |
| `@xd 查询等级 (玩家名)` | 查询玩家等级，留空查自己                                |
| `@xd 查询装备 (玩家名)` | 查询玩家装备，留空查自己                                |
| `@xd 井字棋`            | 两人输入后开启井字棋，可用 `@xd 3 1` 落子到第三列第一行 |
| `@xd 打开/关闭连杀播报` | 控制连杀播报开关                                        |
| `@xd 进入/退出操控模式` | 远程操控我自己，格式见操控模式指令                      |

#### AI设置命令

| 命令                           | 功能           |
| ------------------------------ | -------------- |
| `@xd ai set 清除上下文`        | 进入新聊天     |
| `@xd ai set new chat`          | 进入新聊天     |
| `@xd ai set 上下文长度 (数字)` | 设置上下文长度 |

*为什么不用更好更快的模型*

- 因为没money

#### 操控模式指令

- 格式：[命令 时间] 前/后/左/右/左转/右转/停/跳/蹲/开火/停火/重火力/技能/重生/走/跑/退出；cmd [任意控制台命令]...
- 为了尽量简洁，进入后不需 @xd

| 动作示例 | 作用                             |
| -------- | -------------------------------- |
| 前 10    | 前进10秒                         |
| 停       | 停止移动与转视角                 |
| 开火 1.2 | 开火1.2秒                        |
| 重生     | 似了可以重生                     |
| cmd quit | 真的要这么做吗TvT                |
| 撤退！   | 【XDbot】好的！撤退！！！ (≧▽≦)/ |

*上下调整视角没找到命令，所以实现不了*
*如果是我忘记退了还能远端控制让我退出去uwu*

#### 全局转拼音系统

- 通过`@xd pinyin open/stop`控制开关

- 通过空格分割，失败数量<长度/2，且第一/第二段长度<7 同时首字母为字母时，才触发拼音转文字
- 若失败率达到字符串总长一半，则不会返回转文字

**示例**：

| 输入例               | 处理结果 |
| -------------------- | -------- |
| wo chaoooooooo       | 失败     |
| me too               | 失败     |
| @ you yi shi mo fa @ | 转换成功 |

*分离拼音暂不支持，由于要考虑的因素过于多，使用CPU消耗过大*

------

## 额外的

- 为了防止我不小心在小图挂机，我将实时自动切换到人多的队伍中，防止在人少的队伍中占位
- 在长时间无人的情况下，我将自动退出游戏，在凌晨时，将改成发送关机提示并在一定时间后自动关机
- 废除命令：
  - @xd oldPinyin (拼音) —— 破损版/手搓转文字
  - 

------

## 技术实现简述

### Squirrel & Python 

#### Squirrel端

- 用 `NSSaveJSONFile` 保存 json 到 save.json
- 循环用 `NSLoadJSONFile` 读取 load.json
- 读取到后清空load.json，查看 state.txt 状态
- 状态为完毕则退出读取循环

#### Python端

- 用 watchdog 监控 save.json
- 有变更后立刻读取，并将 state.txt 设为处理中
- 多线程处理数据，完成后输出到 load.json
- 若所有处理线程全部完毕，将state.txt置为完毕

#### 代码

> squirrel 从零开始，一点点扒mod写法，所以存在以下要素：
>
> 依托代码、轻信AI、命名随意、重复造轮子、复用率奇低、随地大小注、难以维护，？？？
>
> 代码详见本仓库



*将作为文档不断更新*
